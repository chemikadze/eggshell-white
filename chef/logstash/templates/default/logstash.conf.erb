input {
  tcp {
    format => "json"
    mode => "server"
    host => "0.0.0.0"
    port => 8514
    ssl_enable => true
    ssl_cert => "/var/lib/logstash/server.pem"
    ssl_key => "/var/lib/logstash/server.key"
    ssl_verify => false
    type => "nxlog"
  }
}
filter {
  date {
      match => [ "EventReceivedTime", "YYYY-MM-dd HH:mm:ss" ]
  }
  mutate {
      type => "nxlog"
      exclude_tags => "_grokparsefailure"
      replace => [ "@message", "%{Message}" ]
      replace => [ "@severity", "%{Severity}" ]
  }
  grok {
      type => "nxlog"
      match => [ "FileName", "%{DATA:instId}/%{DATA:jobId}\.%{DATA:stepId}\.%{DATA:stepname}/%{GREEDYDATA:filename}" ]
      singles => true
  }
  mutate {
      type => "nxlog"
      remove => [ "Message", "Severity", "SourceModuleType", "SourceModuleName", "EventReceivedTime", "FileName", "@source_path", "@source" ]
  }
}
output {
  stdout { debug => true }
  elasticsearch {
      index => "logstash-%{+YYYY.MM.dd.HH}"
      embedded => true
  }
}
